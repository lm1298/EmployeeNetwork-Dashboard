{% extends 'base.html' %}

{% block content %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>User Calendar</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.10.2/fullcalendar.min.css">
    <style>
        #calendar {
            max-width: 900px;
            margin: 50px auto;
        }
        .fc-event {
            font-size: 14px;
            padding: 5px;
        }
        #eventForm {
            display: none; /* Keep it hidden by default */
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            z-index: 2; /* Ensure it sits above the backdrop */
        }
        #modalBackdrop {
            display: none; /* Hidden by default */
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 1; /* Ensure it's below the modal but above everything else */
        }
    </style>
</head>

<body>
    <div id="calendar"></div>
    <div id="modalBackdrop"></div>
    <!-- Event Creation Form -->
    <div id="eventForm">
       
        <input type="text" id="title" placeholder="Event Title" required>
        <input type="datetime-local" id="start" required>
        <input type="datetime-local" id="end" required>
        <button id="createEvent">Create Event</button>
        <button id="cancelEvent">Cancel</button>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.10.2/fullcalendar.min.js"></script>
    <script>
        $(document).ready(function() {
            $('#calendar').fullCalendar({
                header: {
                    left: 'prev,next today',
                    center: 'title',
                    right: 'month,agendaWeek,agendaDay'
                },
                selectable: true,
                selectHelper: true,
                select: function(start, end) {
                    var startDate = moment(start).format('YYYY-MM-DDTHH:mm');
                    var endDate = moment(end).format('YYYY-MM-DDTHH:mm');
                    $('#start').val(startDate);
                    $('#end').val(endDate);
                    $('#eventForm').show();
                },
                events: '/events/',
            });
    
            $('#createEvent').click(function() {
                var title = $('#title').val();
                var start = $('#start').val();
                var end = $('#end').val();
                $.post('/create-event/', {title: title, start: start, end: end}, function(data) {
                    $('#calendar').fullCalendar('renderEvent', {
                        title: title,
                        start: start,
                        end: end,
                        allDay: false
                    }, true);
                    $('#eventForm').hide();
                    $('#eventForm')[0].reset();
                }).fail(function() {
                    alert("Error creating event.");
                });
            });
    
            $('#cancelEvent').click(function() {
                $('#eventForm').hide();
                $('#eventForm')[0].reset();
            });
        });
    </script>
{% endblock %}